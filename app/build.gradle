apply plugin: 'com.android.application'

def devTwaManifest = [
        applicationId              : 'app.passculture.testing.webapp',
        hostName                   : 'app.passculture-testing.beta.gouv.fr', // The domain being opened in the TWA.
        launchUrl                  : '/', // The start path for the TWA. Must be relative to the domain.
        name                       : 'pass Culture - Testing', // The application name.
        launcherName               : 'pass Culture - Testing', // The name shown on the Android Launcher.
        themeColor                 : '#FFFFFF', // The color used for the status bar.
        navigationColor            : '#000000', // The color used for the navigation bar.
        backgroundColor            : '#EB0055', // The color used for the splash screen background.
        enableNotifications        : false, // Set to true to enable notification delegation.
        // Every shortcut must include the following fields:
        // - name: String that will show up in the shortcut.
        // - short_name: Shorter string used if |name| is too long.
        // - url: Absolute path of the URL to launch the app with (e.g '/create').
        // - icon: Name of the resource in the drawable folder to use as an icon.
        shortcuts                  : [],
        // The duration of fade out animation in milliseconds to be played when removing splash screen.
        splashScreenFadeOutDuration: 300,
        // The fallback strategy for when Trusted Web Activity is not avilable. Possible values are
        // 'customtabs' and 'webview'.
        fallbackType               : 'customtabs'
]
def prodTwaManifest = [
        applicationId              : 'app.passculture.webapp',
        hostName                   : 'app.passculture.beta.gouv.fr', // The domain being opened in the TWA.
        launchUrl                  : '/', // The start path for the TWA. Must be relative to the domain.
        name                       : 'pass Culture', // The application name.
        launcherName               : 'pass Culture', // The name shown on the Android Launcher.
        themeColor                 : '#FFFFFF', // The color used for the status bar.
        navigationColor            : '#000000', // The color used for the navigation bar.
        backgroundColor            : '#EB0055', // The color used for the splash screen background.
        enableNotifications        : false, // Set to true to enable notification delegation.
        // Every shortcut must include the following fields:
        // - name: String that will show up in the shortcut.
        // - short_name: Shorter string used if |name| is too long.
        // - url: Absolute path of the URL to launch the app with (e.g '/create').
        // - icon: Name of the resource in the drawable folder to use as an icon.
        shortcuts                  : [],
        // The duration of fade out animation in milliseconds to be played when removing splash screen.
        splashScreenFadeOutDuration: 300,
        // The fallback strategy for when Trusted Web Activity is not avilable. Possible values are
        // 'customtabs' and 'webview'.
        fallbackType               : 'customtabs'
]

android {
    compileSdkVersion 29
    defaultConfig {
        applicationId "app.passculture"
        minSdkVersion 19
        targetSdkVersion 29
        versionCode 1
        versionName "First build"

        resValue "string", "appName", devTwaManifest.name
        resValue "string", "launcherName", devTwaManifest.launcherName
        resValue "string", "hostName", devTwaManifest.hostName

        def launchUrl = "https://" + devTwaManifest.hostName + devTwaManifest.launchUrl
        resValue "string", "launchUrl", launchUrl

        def webManifestUrl = "https://" + devTwaManifest.hostName + "/manifest.json"
        resValue "string", "webManifestUrl", webManifestUrl

        // This variable below expresses the relationship between the app and the site,
        // as documented in the TWA documentation at
        // https://developers.google.com/web/updates/2017/10/using-twa#set_up_digital_asset_links_in_an_android_app
        // and is injected into the AndroidManifest.xml
        resValue "string", "assetStatements",
                '[{ \\"relation\\": [\\"delegate_permission/common.handle_all_urls\\"],' +
                        '\\"target\\": {\\"namespace\\": \\"web\\", \\"site\\": \\"https://' +
                        devTwaManifest.hostName + '\\"}}]'

        resValue "color", "colorPrimary", devTwaManifest.themeColor
        resValue "color", "navigationColor", devTwaManifest.navigationColor
        resValue "color", "backgroundColor", devTwaManifest.backgroundColor
        resValue "string", "providerAuthority", devTwaManifest.applicationId + '.fileprovider'
        resValue "bool", "enableNotification", devTwaManifest.enableNotifications.toString()

        devTwaManifest.shortcuts.eachWithIndex { shortcut, index ->
            resValue "string", "shortcut_name_$index", "$shortcut.name"
            resValue "string", "shortcut_short_name_$index", "$shortcut.short_name"
        }

        resValue "integer", "splashScreenFadeOutDuration", devTwaManifest.splashScreenFadeOutDuration.toString()
        resValue "string", "fallbackType", devTwaManifest.fallbackType
    }

    buildTypes {
        debug {
            applicationIdSuffix ".testing.webapp"
        }

        release {
            minifyEnabled true

            applicationIdSuffix ".webapp"
            resValue "string", "appName", prodTwaManifest.name
            resValue "string", "launcherName", prodTwaManifest.launcherName
            resValue "string", "hostName", prodTwaManifest.hostName

            def launchUrl = "https://" + prodTwaManifest.hostName + prodTwaManifest.launchUrl
            resValue "string", "launchUrl", launchUrl

            def webManifestUrl = "https://" + prodTwaManifest.hostName + "/manifest.json"
            resValue "string", "webManifestUrl", webManifestUrl

            // This variable below expresses the relationship between the app and the site,
            // as documented in the TWA documentation at
            // https://developers.google.com/web/updates/2017/10/using-twa#set_up_digital_asset_links_in_an_android_app
            // and is injected into the AndroidManifest.xml
            resValue "string", "assetStatements",
                    '[{ \\"relation\\": [\\"delegate_permission/common.handle_all_urls\\"],' +
                            '\\"target\\": {\\"namespace\\": \\"web\\", \\"site\\": \\"https://' +
                            prodTwaManifest.hostName + '\\"}}]'

            resValue "color", "colorPrimary", prodTwaManifest.themeColor
            resValue "color", "navigationColor", prodTwaManifest.navigationColor
            resValue "color", "backgroundColor", prodTwaManifest.backgroundColor
            resValue "string", "providerAuthority", prodTwaManifest.applicationId + '.fileprovider'
            resValue "bool", "enableNotification", prodTwaManifest.enableNotifications.toString()

            prodTwaManifest.shortcuts.eachWithIndex { shortcut, index ->
                resValue "string", "shortcut_name_$index", "$shortcut.name"
                resValue "string", "shortcut_short_name_$index", "$shortcut.short_name"
            }

            resValue "integer", "splashScreenFadeOutDuration", prodTwaManifest.splashScreenFadeOutDuration.toString()
            resValue "string", "fallbackType", prodTwaManifest.fallbackType
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation 'com.google.androidbrowserhelper:androidbrowserhelper:1.3.0'
}
